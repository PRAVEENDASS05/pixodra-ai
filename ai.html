<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pixodra.ai</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">

<!-- html2pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  background:radial-gradient(circle at top,#1e293b,#020617);
  animation:pageFade .6s ease;
}
@keyframes pageFade{from{opacity:0}to{opacity:1}}

.fade{animation:fade .3s ease}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1}}

.glow{box-shadow:0 0 30px rgba(99,102,241,.35)}
textarea:focus{box-shadow:0 0 25px rgba(99,102,241,.45)}

.lang{padding:6px 14px;border-radius:999px;background:rgba(255,255,255,.08)}
.lang.active{background:#6366f1}

.menu{transition:.35s cubic-bezier(.4,0,.2,1)}
</style>
</head>

<body class="text-white min-h-screen">

<!-- SIDEBAR -->
<div id="menu"
 class="fixed inset-y-0 left-0 w-72 bg-slate-900/95 backdrop-blur
 border-r border-white/10 z-50 p-4 -translate-x-full menu flex flex-col">

  <!-- USER EMAIL BUTTON -->
  <button onclick="closeMenu()"
    id="userEmailBtn"
    class="w-full px-4 py-3 rounded-xl bg-indigo-600/30 mb-4 text-left">
    user@email.com
  </button>

  <button onclick="newChat()"
    class="w-full text-left px-4 py-3 rounded-xl hover:bg-white/10">
    ‚ûï New Chat
  </button>

  <button onclick="location.href='symposium.html'"
    class="w-full text-left px-4 py-3 rounded-xl hover:bg-white/10">
    üéì Symposium Finder
  </button>

  <!-- PUSH LOGOUT TO BOTTOM -->
  <div class="mt-auto pt-4">
    <button onclick="logout()"
      class="w-full text-left px-4 py-3 rounded-xl bg-red-600/30">
       Logout
    </button>
  </div>
</div>

<!-- MAIN -->
<div class="max-w-4xl mx-auto p-4">

<!-- HEADER -->
<div class="flex justify-between items-center mb-4">
  <button onclick="toggleMenu()" class="text-2xl">‚ò∞</button>
  <h1 class="text-3xl font-bold">
    PIXODRA<span class="text-indigo-400">.AI</span>
  </h1>
</div>

<!-- LANGUAGE -->
<div class="flex gap-2 mb-3 flex-wrap">
  <button class="lang active" onclick="setLang('english',this)">English</button>
  <button class="lang" onclick="setLang('tamil',this)">Tamil</button>
  <button class="lang" onclick="setLang('tanglish',this)">Tanglish</button>
</div>

<!-- CHAT -->
<div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl p-4 glow">
  <div id="chat" class="space-y-4 mb-4 max-h-[60vh] overflow-y-auto"></div>

  <textarea id="input" rows="3"
    class="w-full p-4 rounded-2xl bg-gray-900 border border-gray-700"
    placeholder="Ask Pixodra anything..."></textarea>

  <div class="flex gap-3 mt-3">
    <button onclick="send()" class="flex-1 bg-white text-black py-3 rounded-xl">
      Send
    </button>
    <button onclick="makePDF()" class="flex-1 bg-indigo-600/30 py-3 rounded-xl">
      Make PDF
    </button>
  </div>
</div>

<p class="text-xs text-center mt-4 text-gray-400">Pixodra-ai (Beta)</p>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyDNCb1OOT1tjvC2G7fd3Lky10_FNbp3_oE",
  authDomain:"pixodra-ai.firebaseapp.com",
  projectId:"pixodra-ai",
  appId:"1:435810946190:web:f7a0fd440179ee433d0ddf"
});
const auth=firebase.auth();

auth.onAuthStateChanged(u=>{
  if(!u) location.href="index.html";
  document.getElementById("userEmailBtn").innerText = u.email;
});

/* MENU */
function toggleMenu(){menu.classList.toggle("-translate-x-full")}
function closeMenu(){menu.classList.add("-translate-x-full")}
function logout(){auth.signOut().then(()=>location.href="index.html")}
function newChat(){chat.innerHTML="";history=[];closeMenu()}

/* CHAT */
let lang="english",history=[],question="";

function setLang(l,b){
  lang=l;
  document.querySelectorAll(".lang").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");

  input.placeholder={
    english:"Ask Pixodra anything...",
    tamil:"‡Æè‡Æ§‡Ææ‡Æµ‡Æ§‡ØÅ ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç @pixodra.ai",
    tanglish:"Enna Vaenum Kelungo"
  }[l];
}

function send(){
  const t=input.value.trim();
  if(!t) return;
  question=t;

  chat.insertAdjacentHTML("beforeend",`
    <div class="fade text-right">
      <div class="inline-block bg-indigo-600/30 px-4 py-2 rounded-2xl">${t}</div>
    </div>
  `);
  input.value="";
  chat.scrollTop=chat.scrollHeight;

  if(t.toLowerCase()==="hi"){
    bot("Vanakkam üòä Ungalukku enna vaedum?");
    return;
  }

  fetch("/api/ask",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:`[${lang}] ${t}`})
  })
  .then(r=>r.json())
  .then(d=>{
    bot(d.reply);
    history.push(d.reply);
  });
}

function bot(m){
  chat.insertAdjacentHTML("beforeend",`
    <div class="fade bg-gray-700/40 px-4 py-2 rounded-2xl">${m}</div>
  `);
  chat.scrollTop=chat.scrollHeight;
}

/* PDF */
function makePDF(){
  if(!history.length) return alert("No content to export");

  const box=document.createElement("div");
  box.style.width="800px";
  box.style.padding="30mm";
  box.style.fontFamily=lang==="tamil"?"'Noto Sans Tamil'":"Times New Roman";
  box.style.color="black";
  box.style.background="white";

  const date=new Date().toLocaleDateString();

  box.innerHTML=`
    <p style="text-decoration:underline;margin-bottom:18px">
      Date: ${date} | Language: ${lang.toUpperCase()} | Version: Pixodra-ai (Beta)
    </p>

    <p style="margin-bottom:20px">
      <b>Question:</b> ${question}
    </p>

    ${history.map(h=>`<p style="margin-bottom:12px">${h}</p>`).join("")}
  `;

  document.body.appendChild(box);

  setTimeout(()=>{
    html2pdf().from(box).set({
      margin:15,
      filename:"pixodraai-response.pdf",
      html2canvas:{scale:2,useCORS:true},
      jsPDF:{format:"a4"}
    }).toPdf().get("pdf").then(pdf=>{
      const h=pdf.internal.pageSize.height;
      const w=pdf.internal.pageSize.width;
      const pages=pdf.internal.getNumberOfPages();

      pdf.setFont("Courier");
      pdf.setFontSize(10);

      for(let i=1;i<=pages;i++){
        pdf.setPage(i);
        pdf.text("Thanks for using Pixodra.ai",15,h-10);
        pdf.text(`Page ${i}`,w-30,h-10);
      }
    }).save().then(()=>box.remove());
  },300);
}
</script>

</body>
</html>
