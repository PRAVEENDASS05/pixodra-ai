<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pixodra.ai</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  background:radial-gradient(circle at top,#1e293b,#020617);
}
.fade{animation:fade .35s ease}
@keyframes fade{from{opacity:0;transform:translateY(14px)}to{opacity:1}}

.menu{transition:.45s cubic-bezier(.4,0,.2,1)}

.menu-btn{
  display:flex;
  align-items:center;
  gap:12px;
  padding:14px 18px;
  border-radius:14px;
  transition:.3s;
}
.menu-btn:hover{
  background:rgba(255,255,255,.08);
  transform:translateX(4px);
}

.lang{padding:6px 14px;border-radius:999px;background:rgba(255,255,255,.08)}
.lang.active{background:#6366f1}

.glow{
  box-shadow:0 0 40px rgba(99,102,241,.25);
}
</style>
</head>

<body class="text-white min-h-screen">

<!-- SIDEBAR -->
<div id="menu"
 class="fixed inset-y-0 left-0 w-72 bg-slate-900/95 backdrop-blur
 border-r border-white/10 z-50 p-5 -translate-x-full menu flex flex-col">

  <!-- PROFILE -->
  <div class="flex items-center gap-4 mb-8">
    <div id="avatar" class="w-12 h-12 rounded-full bg-indigo-600 flex items-center justify-center font-bold text-lg">U</div>
    <div class="flex-1">
      <div id="displayName" class="font-semibold text-lg">User</div>
      <div id="userEmail" class="text-xs text-gray-400 truncate"></div>
    </div>
    <div class="text-gray-400">‚ñæ</div>
  </div>

  <!-- MENU ITEMS -->
  <div class="space-y-2">
    <button onclick="newChat()" class="menu-btn w-full">
      ‚ûï <span>New Chat</span>
    </button>

    <button onclick="location.href='symposium.html'" class="menu-btn w-full">
      üéì <span>Symposium Finder</span>
    </button>
  </div>

  <!-- BOTTOM ACTIONS -->
  <div class="mt-auto space-y-3 pt-6 border-t border-white/10">
    <button onclick="closeMenu()" class="menu-btn w-full bg-indigo-600/30 justify-center">
      ‚¨Ö Back to AI
    </button>

    <button onclick="logout()" class="menu-btn w-full bg-red-600/30 justify-center">
      üö™ Logout
    </button>
  </div>
</div>

<!-- MAIN -->
<div class="max-w-4xl mx-auto p-4">

<!-- HEADER -->
<div class="flex justify-between items-center mb-4">
  <button onclick="toggleMenu()" class="text-2xl">‚ò∞</button>
  <h1 class="text-3xl font-bold">PIXODRA<span class="text-indigo-400">.AI</span></h1>
</div>

<!-- LANG -->
<div class="flex gap-2 mb-3">
  <button class="lang active" onclick="setLang('english',this)">English</button>
  <button class="lang" onclick="setLang('tamil',this)">Tamil</button>
  <button class="lang" onclick="setLang('tanglish',this)">Tanglish</button>
</div>

<!-- CHAT -->
<div class="bg-white/5 backdrop-blur border border-white/10 rounded-3xl p-4 glow">
  <div id="chat" class="space-y-4 mb-4 max-h-[60vh] overflow-y-auto"></div>

  <textarea id="input" rows="3"
    class="w-full p-4 rounded-2xl bg-gray-900 border border-gray-700 focus:ring-2 focus:ring-indigo-500"
    placeholder="Ask Pixodra anything..."></textarea>

  <div class="flex gap-3 mt-3">
    <button onclick="send()" class="flex-1 bg-white text-black py-3 rounded-xl">Send</button>
    <button onclick="makePDF()" class="flex-1 bg-indigo-600/30 py-3 rounded-xl">Make PDF</button>
  </div>
</div>

<p class="text-xs text-center mt-4 text-gray-400">Pixodra-ai (Beta)</p>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDNCb1OOT1tjvC2G7fd3Lky10_FNbp3_oE",
  authDomain:"pixodra-ai.firebaseapp.com",
  projectId:"pixodra-ai",
  appId:"1:435810946190:web:f7a0fd440179ee433d0ddf"
});
const auth=firebase.auth();

auth.onAuthStateChanged(u=>{
  if(!u) location.href="index.html";
  displayName.innerText=u.displayName||u.email.split("@")[0];
  userEmail.innerText=u.email;
  avatar.innerText=(u.displayName||u.email)[0].toUpperCase();
});

function toggleMenu(){menu.classList.toggle("-translate-x-full")}
function closeMenu(){menu.classList.add("-translate-x-full")}
function logout(){auth.signOut().then(()=>location.href="index.html")}
function newChat(){chat.innerHTML="";history=[];closeMenu()}

let lang="english",history=[],question="";
let thinkingEl=null;

function setLang(l,b){
  lang=l;
  document.querySelectorAll(".lang").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");

  input.placeholder={
    english:"Ask Pixodra anything...",
    tamil:"‡Æè‡Æ§‡Ææ‡Æµ‡Æ§‡ØÅ ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç @pixodra.ai",
    tanglish:"Enna Vaenum Kelungo"
  }[l];
}

function send(){
  const t=input.value.trim();
  if(!t) return;
  question=t;

  chat.insertAdjacentHTML("beforeend",`
    <div class="fade text-right">
      <div class="inline-block bg-indigo-600/30 px-4 py-2 rounded-2xl">${t}</div>
    </div>
  `);
  input.value="";
  chat.scrollTop=chat.scrollHeight;

  showThinking();

  fetch("/api/ask",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:`[${lang}] ${t}`})})
  .then(r=>r.json())
  .then(d=>{
    removeThinking();
    bot(d.reply);
    history.push(d.reply);
  });
}

function showThinking(){
  thinkingEl=document.createElement("div");
  thinkingEl.className="fade text-gray-400";
  thinkingEl.innerText="Pixodra-AI is thinking...";
  chat.appendChild(thinkingEl);
  chat.scrollTop=chat.scrollHeight;
}

function removeThinking(){thinkingEl?.remove()}

function bot(m){
  chat.insertAdjacentHTML("beforeend",`
    <div class="fade bg-gray-700/40 px-4 py-2 rounded-2xl">${m}</div>
  `);
  chat.scrollTop=chat.scrollHeight;
}

/* PDF unchanged & aligned */
function makePDF(){
  if(!history.length) return alert("No content");

  const box=document.createElement("div");
  box.style.width="210mm";
  box.style.padding="25mm";
  box.style.fontFamily=lang==="tamil"?"'Noto Sans Tamil'":"Times New Roman";
  box.style.lineHeight="1.6";
  box.style.color="black";
  box.style.background="white";

  box.innerHTML=`
    <div style="border-bottom:1px solid #000;padding-bottom:8px;margin-bottom:18px">
      Date: ${new Date().toLocaleDateString()} | Language: ${lang.toUpperCase()} | Version: Pixodra-ai (Beta)
    </div>
    <div style="margin-bottom:18px"><strong>Question:</strong><br>${question}</div>
    ${history.map(h=>`<div style="margin-bottom:14px">${h}</div>`).join("")}
  `;

  document.body.appendChild(box);

  setTimeout(()=>{
    html2pdf().from(box).set({
      filename:"pixodraai-response.pdf",
      html2canvas:{scale:2},
      jsPDF:{unit:"mm",format:"a4"}
    }).toPdf().get("pdf").then(pdf=>{
      const h=pdf.internal.pageSize.height;
      const w=pdf.internal.pageSize.width;
      pdf.setFont("Courier");
      pdf.setFontSize(10);
      for(let i=1;i<=pdf.internal.getNumberOfPages();i++){
        pdf.setPage(i);
        pdf.text("Thanks for using Pixodra.ai",15,h-10);
        pdf.text(`Page ${i}`,w-30,h-10);
      }
    }).save().then(()=>box.remove());
  },300);
}
</script>

</body>
</html>
