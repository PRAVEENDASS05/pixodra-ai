<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pixodra.ai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tamil-safe font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap" rel="stylesheet">

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top, #1e293b, #020617);
    }

    .msg { animation: slideFade .35s ease-out; }
    @keyframes slideFade {
      from { opacity:0; transform:translateY(12px) scale(.98) }
      to { opacity:1; transform:translateY(0) scale(1) }
    }

    .typing span { animation: blink 1.4s infinite both; }
    .typing span:nth-child(2){animation-delay:.2s}
    .typing span:nth-child(3){animation-delay:.4s}
    @keyframes blink {
      0%{opacity:.2} 20%{opacity:1} 100%{opacity:.2}
    }

    .btn { transition: all .25s ease; }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 30px rgba(99,102,241,.25);
    }

    .lang {
      padding:6px 14px;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      cursor:pointer;
      transition:.25s;
    }
    .lang:hover { background:rgba(255,255,255,.15); }
    .active {
      background:linear-gradient(135deg,#6366f1,#8b5cf6);
      font-weight:600;
      box-shadow:0 0 0 2px rgba(99,102,241,.4);
    }
  </style>
</head>

<body class="min-h-screen text-white">

<div class="max-w-4xl mx-auto p-4">

  <!-- HEADER -->
  <div class="flex justify-between items-center mb-5">
    <h1 class="text-3xl font-bold tracking-wide">
      PIXODRA<span class="text-indigo-400">.AI</span>
    </h1>

    <button onclick="location.href='/symposium'"
      class="btn px-4 py-2 rounded-xl bg-indigo-600/20 text-indigo-300">
      ðŸŽ“ Symposium Finder
    </button>
  </div>

  <!-- LANGUAGE + TOOLS -->
  <div class="flex gap-3 mb-4 flex-wrap">
    <button class="lang active" onclick="setLang('english',this)">English</button>
    <button class="lang" onclick="setLang('tamil',this)">Tamil</button>
    <button class="lang" onclick="setLang('tanglish',this)">Tanglish</button>

    <!-- NEW TOOLS BUTTON -->
    <button class="lang" onclick="openTools()">ðŸ§° Tools</button>
  </div>

  <!-- CHAT CARD -->
  <div class="
    bg-white/5 backdrop-blur-xl
    border border-white/10
    rounded-3xl shadow-2xl
    p-4 sm:p-6
  ">

    <div id="chat" class="space-y-4 mb-4 max-h-[60vh] overflow-y-auto pr-1"></div>

    <textarea id="input" rows="3"
      class="
        w-full p-4 rounded-2xl
        bg-gray-900/80 border border-gray-700
        focus:outline-none focus:ring-2 focus:ring-indigo-500
        transition
      "
      placeholder="Ask Pixodra anythingâ€¦"></textarea>

    <div class="flex gap-3 mt-4">
      <button onclick="send()"
        class="btn flex-1 bg-white text-black py-3 rounded-2xl font-semibold">
        Send
      </button>

      <button onclick="makePDF()"
        class="btn flex-1 bg-indigo-600/30 py-3 rounded-2xl">
        Make PDF
      </button>
    </div>
  </div>

  <p class="text-xs text-center text-gray-400 mt-4">
    Pixodra-ai (Beta)
  </p>
</div>

<script>
let lang = "english";
let history = [];
let question = "";

function setLang(l, btn){
  lang = l;
  document.querySelectorAll('.lang').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');

  input.placeholder = {
    english:"Ask Pixodra anythingâ€¦",
    tamil:"Ungal kelviyai inge type pannungaâ€¦",
    tanglish:"Ungal question-ah inga type pannungaâ€¦"
  }[l];
}

function openTools(){
  alert("ðŸ§° Tools coming soon!\n\nâ€¢ PDF Tools\nâ€¢ Study Tools\nâ€¢ Symposium Tools");
}

async function send(){
  const text = input.value.trim();
  if(!text) return;

  question = text;

  chat.innerHTML += `
    <div class="text-right msg">
      <div class="inline-block bg-indigo-600/30 px-4 py-2 rounded-2xl">
        ${text}
      </div>
    </div>`;
  input.value="";
  chat.scrollTop=chat.scrollHeight;

  if(text.toLowerCase()==="hi"){
    bot("Vanakkam ðŸ˜Š Ungalukku enna vendum?");
    return;
  }

  const typing = document.createElement("div");
  typing.innerHTML = `
    <div class="msg inline-block bg-gray-700/40 px-4 py-2 rounded-2xl typing">
      Pixodra typing<span>.</span><span>.</span><span>.</span>
    </div>`;
  chat.appendChild(typing);

  const r = await fetch("/api/ask",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ message:`[${lang}] ${text}` })
  });

  const d = await r.json();
  typing.remove();
  bot(d.reply);
  history.push(d.reply);
}

function bot(t){
  chat.innerHTML += `
    <div class="msg bg-gray-700/50 px-4 py-2 rounded-2xl">
      ${t}
    </div>`;
  chat.scrollTop=chat.scrollHeight;
}

function makePDF(){
  if(!history.length){ alert("No content"); return; }

  const font = lang==="tamil"
    ? "'Noto Sans Tamil', sans-serif"
    : "serif";

  const today = new Date().toLocaleDateString();

  const box=document.createElement("div");
  box.style.padding="20mm";
  box.style.fontFamily=font;
  box.style.color="black";
  box.style.background="white";
  box.style.lineHeight="1.8";

  box.innerHTML=`
    <div style="text-align:center;margin-bottom:20px">
      <div style="text-decoration:underline;font-weight:600">
        Date: ${today} | Language: ${lang.toUpperCase()} | Version: Pixodra-ai (Beta)
      </div>
      <div style="font-weight:bold;margin-top:10px">
        Question: ${question}
      </div>
    </div>
    ${history.map(h=>`<p>${h}</p>`).join("")}
  `;
  document.body.appendChild(box);

  html2pdf().from(box).toPdf().get('pdf').then(pdf=>{
    const pages=pdf.internal.getNumberOfPages();
    const h=pdf.internal.pageSize.height;
    const w=pdf.internal.pageSize.width;

    for(let i=1;i<=pages;i++){
      pdf.setPage(i);
      pdf.setFont("Courier","italic");
      pdf.setFontSize(10);
      pdf.text("Thanks for using Pixodra.ai",15,h-10);
      pdf.text(`Page ${i} of ${pages}`,w-45,h-10);
    }
  }).save("pixodra-response.pdf")
    .then(()=>box.remove());
}
</script>

</body>
</html>
