<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pixodra.ai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-up { animation: fadeUp 0.6s ease-out; }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-gray-900 to-black min-h-screen text-white">

<!-- CONTAINER -->
<div class="max-w-4xl mx-auto p-4 fade-up">

  <!-- HEADER -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">PIXODRA.AI</h1>

    <button
      onclick="window.location.href='/symposium'"
      class="px-4 py-2 rounded-xl bg-indigo-600/20 text-indigo-400 hover:bg-indigo-600/30 transition">
      ðŸŽ“ Symposium Finder
    </button>
  </div>

  <!-- LANGUAGE SELECT -->
  <div class="flex gap-3 mb-4">
    <button onclick="setLang('english')" class="lang-btn">English</button>
    <button onclick="setLang('tamil')" class="lang-btn">Tamil</button>
    <button onclick="setLang('tanglish')" class="lang-btn">Tanglish</button>
  </div>

  <!-- CHAT BOX -->
  <div class="bg-[#0f172a]/90 rounded-2xl shadow-xl p-4 mb-4">
    <div id="chat" class="space-y-3 mb-4 max-h-[50vh] overflow-y-auto"></div>

    <textarea
      id="userInput"
      rows="3"
      placeholder="Ask Pixodra..."
      class="w-full p-3 rounded-xl bg-gray-800 border border-gray-700 focus:outline-none"></textarea>

    <div class="flex gap-3 mt-3">
      <button onclick="askPixodra()" class="btn-primary">Send</button>
      <button onclick="makePDF()" class="btn-secondary">Make PDF</button>
    </div>
  </div>

  <p class="text-xs text-gray-500 text-center">
    Built by Pixodra Technologies
  </p>
</div>

<script>
  let selectedLang = "english";
  let conversation = [];

  function setLang(lang) {
    selectedLang = lang;
    alert("Language set to " + lang);
  }

  async function askPixodra() {
    const input = document.getElementById("userInput").value.trim();
    if (!input) return;

    const chat = document.getElementById("chat");

    chat.innerHTML += `
      <div class="text-right">
        <div class="inline-block bg-indigo-600/20 p-2 rounded-xl">${input}</div>
      </div>`;

    document.getElementById("userInput").value = "";

    if (input.toLowerCase() === "hi") {
      const reply = "Vanakkam! Ungalukku enna vendum? ðŸ˜Š";
      chat.innerHTML += botBubble(reply);
      conversation.push(reply);
      return;
    }

    chat.innerHTML += botBubble("Pixodra thinking... ðŸ¤–");

    const res = await fetch("/api/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: `[${selectedLang}] ${input}`
      })
    });

    const data = await res.json();
    chat.lastElementChild.remove();
    chat.innerHTML += botBubble(data.reply);
    conversation.push(data.reply);
  }

  function botBubble(text) {
    return `
      <div class="text-left">
        <div class="inline-block bg-gray-700/50 p-2 rounded-xl">${text}</div>
      </div>`;
  }

  function makePDF() {
    if (conversation.length === 0) {
      alert("No content to export");
      return;
    }

    const blob = new Blob([conversation.join("\n\n")], { type: "application/pdf" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "pixodra-response.pdf";
    link.click();
  }
</script>

<style>
  .lang-btn {
    padding: 6px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,0.08);
    transition: 0.2s;
  }
  .lang-btn:hover { background: rgba(255,255,255,0.15); }

  .btn-primary {
    flex: 1;
    background: white;
    color: black;
    padding: 10px;
    border-radius: 12px;
    font-weight: 600;
  }
  .btn-secondary {
    flex: 1;
    background: rgba(255,255,255,0.15);
    padding: 10px;
    border-radius: 12px;
  }
</style>

</body>
</html>
