<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pixodra.ai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tamil-safe font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil&display=swap" rel="stylesheet">

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body { font-family: system-ui, sans-serif; }
    .fade { animation: fade .3s ease-out; }
    @keyframes fade { from {opacity:0; transform:translateY(6px)} to {opacity:1} }

    .lang { padding:6px 14px; border-radius:999px; background:#1f2937; cursor:pointer }
    .active { background:#6366f1; font-weight:600 }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-900 to-black text-white min-h-screen">

<div class="max-w-4xl mx-auto p-4">

  <div class="flex justify-between mb-4">
    <h1 class="text-3xl font-bold">PIXODRA.AI</h1>
    <button onclick="location.href='/symposium'"
      class="px-4 py-2 rounded-xl bg-indigo-600/20 text-indigo-400">
      ðŸŽ“ Symposium Finder
    </button>
  </div>

  <div class="flex gap-3 mb-4">
    <button class="lang active" onclick="setLang('english',this)">English</button>
    <button class="lang" onclick="setLang('tamil',this)">Tamil</button>
    <button class="lang" onclick="setLang('tanglish',this)">Tanglish</button>
  </div>

  <div class="bg-[#0f172a] p-4 rounded-2xl shadow-xl">
    <div id="chat" class="space-y-3 mb-4 max-h-[55vh] overflow-y-auto"></div>

    <textarea id="input" rows="3"
      class="w-full p-3 rounded-xl bg-gray-800 border border-gray-700"
      placeholder="Ask Pixodra anythingâ€¦"></textarea>

    <div class="flex gap-3 mt-3">
      <button onclick="send()"
        class="flex-1 bg-white text-black py-2 rounded-xl font-semibold">
        Send
      </button>
      <button onclick="makePDF()"
        class="flex-1 bg-white/20 py-2 rounded-xl">
        Make PDF
      </button>
    </div>
  </div>
</div>

<script>
let lang = "english";
let history = [];
let question = "";

function setLang(l, btn){
  lang = l;
  document.querySelectorAll('.lang').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');

  input.placeholder = {
    english:"Ask Pixodra anythingâ€¦",
    tamil:"Ungal kelviyai inge type pannungaâ€¦",
    tanglish:"Ungal question-ah inga type pannungaâ€¦"
  }[l];
}

async function send(){
  const text = input.value.trim();
  if(!text) return;

  question = text;

  chat.innerHTML += `
    <div class="text-right fade">
      <div class="inline-block bg-indigo-600/30 px-3 py-2 rounded-xl">${text}</div>
    </div>`;
  input.value="";
  chat.scrollTop=chat.scrollHeight;

  if(text.toLowerCase()==="hi"){
    bot("Vanakkam ðŸ˜Š Ungalukku enna vendum?");
    return;
  }

  bot("Pixodra is thinking...");

  const r = await fetch("/api/ask",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ message:`[${lang}] ${text}` })
  });

  const d = await r.json();
  chat.lastChild.remove();
  bot(d.reply);
  history.push(d.reply);
}

function bot(t){
  chat.innerHTML += `
    <div class="fade bg-gray-700/50 px-3 py-2 rounded-xl">${t}</div>`;
  chat.scrollTop=chat.scrollHeight;
}

function makePDF(){
  if(!history.length){ alert("No content"); return; }

  const font = lang==="tamil"
    ? "'Noto Sans Tamil', sans-serif"
    : "serif";

  const box=document.createElement("div");
  box.style.padding="20mm";
  box.style.fontFamily=font;
  box.style.color="black";
  box.style.background="white";

  const today = new Date().toLocaleDateString();

  box.innerHTML=`
    <div style="font-weight:bold;margin-bottom:12px">
      Question: ${question} |
      Date: ${today} |
      Language: ${lang.toUpperCase()} |
      Version: Pixodra-ai (Beta)
    </div>
    ${history.map(h=>`<p>${h}</p>`).join("")}
  `;
  document.body.appendChild(box);

  html2pdf().from(box).toPdf().get('pdf').then(pdf=>{
    const pages=pdf.internal.getNumberOfPages();
    const h=pdf.internal.pageSize.height;
    const w=pdf.internal.pageSize.width;

    for(let i=1;i<=pages;i++){
      pdf.setPage(i);
      pdf.setFont("Courier","italic");
      pdf.setFontSize(10);
      pdf.setTextColor(0);
      pdf.text("Thanks for using Pixodra.ai",15,h-10);
      pdf.text(`Page ${i} of ${pages}`,w-45,h-10);
    }
  }).save("pixodra-response.pdf")
    .then(()=>box.remove());
}
</script>

</body>
</html>
