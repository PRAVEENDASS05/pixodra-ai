<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pixodra.ai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    .chat-scroll {
      scrollbar-width: thin;
      scrollbar-color: #6366f1 transparent;
    }
    .chat-scroll::-webkit-scrollbar {
      width: 6px;
    }
    .chat-scroll::-webkit-scrollbar-thumb {
      background: #6366f1;
      border-radius: 10px;
    }
    .fade-in {
      animation: fade 0.25s ease-in-out;
    }
    @keyframes fade {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-gray-900 to-black min-h-screen flex items-center justify-center">

  <!-- APP CONTAINER -->
  <div class="w-full max-w-4xl h-[95vh] bg-[#0f172a]/90 backdrop-blur-xl rounded-3xl shadow-2xl flex flex-col overflow-hidden">

    <!-- HEADER -->
    <header class="flex items-center justify-between px-6 py-4 border-b border-white/10">
      <div>
        <h1 class="text-xl font-bold text-white tracking-wide">
          PIXODRA<span class="text-indigo-400">.AI</span>
        </h1>
        <p class="text-xs text-gray-400">Your friendly AI study companion</p>
      </div>
      <span class="text-xs text-gray-500">Beta</span>
    </header>

    <!-- CHAT AREA -->
    <main id="chat" class="flex-1 px-4 py-6 space-y-4 overflow-y-auto chat-scroll"></main>

    <!-- CONTROLS -->
    <footer class="border-t border-white/10 p-4 space-y-3">

      <!-- OPTIONS -->
      <div class="flex flex-wrap gap-2">
        <button onclick="setLanguage('english')" class="opt-btn">English</button>
        <button onclick="setLanguage('tamil')" class="opt-btn">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
        <button onclick="setLanguage('tanglish')" class="opt-btn">Tanglish</button>

        <button onclick="useTool('summarize')" class="opt-btn bg-emerald-600/20 text-emerald-400">
          Summarize
        </button>
        <button onclick="useTool('notes')" class="opt-btn bg-amber-600/20 text-amber-400">
          Short Notes
        </button>
        <button onclick="makePDF()" class="opt-btn bg-indigo-600/20 text-indigo-400">
          Make PDF
        </button>
      </div>

      <!-- INPUT BAR -->
      <div class="flex items-end gap-3">
        <textarea
          id="userInput"
          rows="1"
          placeholder="Message Pixodra‚Ä¶"
          class="flex-1 resize-none bg-[#020617] text-white p-3 rounded-xl border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500"
        ></textarea>

        <button onclick="askPixodra()"
          class="bg-indigo-600 hover:bg-indigo-500 active:scale-95 transition px-5 py-3 rounded-xl font-semibold text-white">
          Send
        </button>
      </div>

      <p class="text-[10px] text-gray-500 text-center">
        Built with ‚ù§Ô∏è by Pixodra Technologies
      </p>
    </footer>

  </div>

<script>
  const { jsPDF } = window.jspdf;

  // Anonymous User ID
  let userId = localStorage.getItem("pixodra_user_id");
  if (!userId) {
    userId = "user_" + Math.random().toString(36).substring(2, 10);
    localStorage.setItem("pixodra_user_id", userId);
  }

  let selectedLanguage = "english";
  let selectedTool = "";
  let lastAnswer = "";

  function setLanguage(lang) {
    selectedLanguage = lang;
  }

  function useTool(tool) {
    selectedTool = tool;
  }

  function addMessage(text, sender = "ai") {
    const chat = document.getElementById("chat");
    const bubble = document.createElement("div");

    bubble.className =
      sender === "user"
        ? "ml-auto max-w-[80%] bg-indigo-600 text-white p-4 rounded-2xl rounded-br-sm text-sm fade-in"
        : "mr-auto max-w-[80%] bg-white/10 text-gray-200 p-4 rounded-2xl rounded-bl-sm text-sm fade-in";

    bubble.innerText = text;
    chat.appendChild(bubble);
    chat.scrollTop = chat.scrollHeight;
  }

  async function askPixodra() {
    const inputBox = document.getElementById("userInput");
    const input = inputBox.value.trim();
    inputBox.value = "";

    if (!input) return;

    addMessage(input, "user");

    // Greeting shortcut
    if (["hi", "hello", "hey"].includes(input.toLowerCase())) {
      addMessage("Vanakkam üòä Ungaluku enna vendum?");
      return;
    }

    let lang =
      selectedLanguage === "tamil"
        ? "Reply only in Tamil."
        : selectedLanguage === "tanglish"
        ? "Reply in Tanglish (Tamil + English mixed)."
        : "Reply in simple English.";

    let tool =
      selectedTool === "summarize"
        ? "Summarize clearly in bullet points."
        : selectedTool === "notes"
        ? "Write short exam-oriented notes."
        : "";

    addMessage("Pixodra is thinking‚Ä¶ ü§ñ");

    try {
      const res = await fetch("/api/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          message: lang + " " + tool + " " + input,
          userId,
          language: selectedLanguage,
          tool: selectedTool,
          timestamp: new Date().toISOString()
        })
      });

      const data = await res.json();
      document.getElementById("chat").lastChild.remove();
      addMessage(data.reply);
      lastAnswer = data.reply;
      selectedTool = "";
    } catch {
      document.getElementById("chat").lastChild.remove();
      addMessage("Something went wrong üòï");
    }
  }

  function makePDF() {
    if (!lastAnswer) {
      alert("No response to convert!");
      return;
    }
    const pdf = new jsPDF();
    const lines = pdf.splitTextToSize(lastAnswer, 180);
    pdf.text(lines, 10, 15);
    pdf.save("Pixodra_Response.pdf");
  }
</script>

<style>
  .opt-btn {
    padding: 0.4rem 0.75rem;
    border-radius: 999px;
    background: rgba(255,255,255,0.05);
    color: #c7d2fe;
    font-size: 0.7rem;
    transition: all 0.2s ease;
  }
  .opt-btn:hover {
    background: rgba(255,255,255,0.12);
    transform: translateY(-1px);
  }
</style>

</body>
</html>
